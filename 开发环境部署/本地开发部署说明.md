# 📖 ToDoListArea 本地开发部署说明

## 🎯 概述

本文档详细说明如何在本地环境中部署和运行ToDoListArea项目的开发版本。开发环境支持代码热重载、实时调试和完整的开发工具链。

## 📋 部署方式对比

| 部署方式 | 优点 | 缺点 | 适用场景 |
|----------|------|------|----------|
| **Docker开发环境** | 环境一致、快速启动、包含所有服务 | 资源占用较高 | 推荐用于日常开发 |
| **本地直接运行** | 性能最佳、调试方便 | 环境配置复杂 | 深度调试和性能优化 |
| **混合模式** | 灵活性高、资源占用适中 | 配置复杂 | 特定组件开发 |

## 🐳 Docker开发环境部署（推荐）

### 快速启动

1. **进入开发环境目录**
   ```bash
   cd 开发环境部署
   ```

2. **运行部署脚本**
   ```bash
   # Windows
   deploy-dev.bat
   
   # Linux/macOS
   chmod +x deploy-dev.sh
   ./deploy-dev.sh
   ```

3. **验证部署**
   - 前端: http://localhost:5175
   - 后端: http://localhost:5006
   - 数据库管理: http://localhost:8080

### 详细配置说明

#### 环境变量配置
```env
# .env.dev 文件内容
DB_SA_PASSWORD=TodoList@2024!Dev
JWT_SECRET_KEY=dev-jwt-secret-key-for-development-only-not-secure-12345678
JWT_ISSUER=ToDoListArea-Dev
JWT_AUDIENCE=ToDoListArea-Dev-Users
JWT_EXPIRATION=120
ASPNETCORE_ENVIRONMENT=Development
NODE_ENV=development
```

#### 服务配置详情

**前端服务 (React + Vite)**:
- 端口: 5175
- 热重载: 支持
- 源码挂载: `../WebCode/todo-frontend/src` → `/app/src`
- 环境变量: 从 `.env.frontend.development` 加载

**后端服务 (ASP.NET Core)**:
- 端口: 5006
- 环境: Development
- 源码挂载: `../ApiCode/ToDoListArea/ToDoListArea` → `/app/src`
- 配置文件: `appsettings.Development.json`

**数据库服务 (SQL Server)**:
- 端口: 1433
- 用户名: sa
- 密码: TodoList@2024!Dev
- 数据持久化: Docker Volume

**Redis缓存**:
- 端口: 6379
- 数据持久化: Docker Volume

**Adminer数据库管理**:
- 端口: 8080
- 用途: 可视化数据库管理

## 💻 本地直接运行部署

### 前置要求
- Node.js >= 18.0.0
- .NET 8 SDK
- SQL Server 2019+ 或 SQL Server Express
- Redis (可选)

### 1. 数据库准备

**安装SQL Server Express**:
```bash
# Windows - 下载并安装SQL Server Express
# https://www.microsoft.com/en-us/sql-server/sql-server-downloads

# Linux - 使用Docker运行SQL Server
docker run -e "ACCEPT_EULA=Y" -e "SA_PASSWORD=TodoList@2024!Dev" \
  -p 1433:1433 --name sqlserver-dev \
  -d mcr.microsoft.com/mssql/server:2022-latest
```

**创建数据库**:
```sql
-- 连接到SQL Server并执行
CREATE DATABASE ToDoListArea;
```

### 2. 后端API部署

```bash
# 进入后端目录
cd ApiCode/ToDoListArea/ToDoListArea

# 恢复NuGet包
dotnet restore

# 更新数据库
dotnet ef database update

# 启动开发服务器
dotnet run --environment Development
```

**后端配置文件** (`appsettings.Development.json`):
```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Server=localhost,1433;Database=ToDoListArea;User Id=sa;Password=TodoList@2024!Dev;TrustServerCertificate=true;"
  },
  "JwtSettings": {
    "SecretKey": "dev-jwt-secret-key-for-development-only-not-secure-12345678",
    "Issuer": "ToDoListArea-Dev",
    "Audience": "ToDoListArea-Dev-Users",
    "ExpirationInMinutes": 120
  },
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  }
}
```

### 3. 前端应用部署

```bash
# 进入前端目录
cd WebCode/todo-frontend

# 安装依赖
npm install

# 启动开发服务器
npm run dev
```

**前端配置文件** (`.env.development`):
```env
VITE_API_BASE_URL=http://localhost:5006/api
VITE_APP_TITLE=智能提醒事项管理系统 (开发版)
VITE_DEBUG_MODE=true
```

## 🔧 混合模式部署

混合模式允许您选择性地在本地运行某些服务，其他服务使用Docker。

### 场景1: 本地前端 + Docker后端

```bash
# 启动后端服务（Docker）
cd 开发环境部署
docker-compose -f docker-compose.dev.yml up -d database backend redis

# 启动前端服务（本地）
cd ../WebCode/todo-frontend
npm run dev
```

### 场景2: 本地后端 + Docker前端

```bash
# 启动数据库（Docker）
cd 开发环境部署
docker-compose -f docker-compose.dev.yml up -d database redis

# 启动后端服务（本地）
cd ../ApiCode/ToDoListArea/ToDoListArea
dotnet run --environment Development

# 启动前端服务（Docker）
cd ../../开发环境部署
docker-compose -f docker-compose.dev.yml up -d frontend
```

## 🔍 开发调试技巧

### 前端调试

1. **浏览器开发者工具**
   - F12打开开发者工具
   - 使用React Developer Tools扩展
   - 网络面板监控API请求

2. **VS Code调试配置**
   ```json
   // .vscode/launch.json
   {
     "version": "0.2.0",
     "configurations": [
       {
         "name": "Launch Chrome",
         "request": "launch",
         "type": "chrome",
         "url": "http://localhost:5175",
         "webRoot": "${workspaceFolder}/WebCode/todo-frontend/src"
       }
     ]
   }
   ```

### 后端调试

1. **VS Code调试配置**
   ```json
   // .vscode/launch.json
   {
     "version": "0.2.0",
     "configurations": [
       {
         "name": ".NET Core Launch (web)",
         "type": "coreclr",
         "request": "launch",
         "preLaunchTask": "build",
         "program": "${workspaceFolder}/ApiCode/ToDoListArea/ToDoListArea/bin/Debug/net8.0/ToDoListArea.dll",
         "args": [],
         "cwd": "${workspaceFolder}/ApiCode/ToDoListArea/ToDoListArea",
         "env": {
           "ASPNETCORE_ENVIRONMENT": "Development"
         }
       }
     ]
   }
   ```

2. **日志调试**
   ```csharp
   // 在Controller中添加日志
   private readonly ILogger<TaskController> _logger;
   
   [HttpGet]
   public async Task<IActionResult> GetTasks()
   {
       _logger.LogInformation("获取任务列表请求");
       // ... 业务逻辑
   }
   ```

### 数据库调试

1. **使用Adminer** (Docker环境)
   - 访问: http://localhost:8080
   - 服务器: database
   - 用户名: sa
   - 密码: TodoList@2024!Dev

2. **使用SQL Server Management Studio**
   - 服务器: localhost,1433
   - 身份验证: SQL Server身份验证
   - 用户名: sa
   - 密码: TodoList@2024!Dev

## 📊 性能监控

### 开发环境性能指标

```bash
# 查看Docker容器资源使用
docker stats

# 查看应用性能
curl -w "@curl-format.txt" -o /dev/null -s http://localhost:5006/health

# curl-format.txt 内容:
#     time_namelookup:  %{time_namelookup}\n
#        time_connect:  %{time_connect}\n
#     time_appconnect:  %{time_appconnect}\n
#    time_pretransfer:  %{time_pretransfer}\n
#       time_redirect:  %{time_redirect}\n
#  time_starttransfer:  %{time_starttransfer}\n
#                     ----------\n
#          time_total:  %{time_total}\n
```

### 前端性能监控

```javascript
// 在前端代码中添加性能监控
console.time('API Request');
fetch('/api/tasks')
  .then(response => {
    console.timeEnd('API Request');
    return response.json();
  });
```

## 🔄 常用开发命令

### Docker环境管理
```bash
# 启动所有服务
docker-compose -f docker-compose.dev.yml up -d

# 停止所有服务
docker-compose -f docker-compose.dev.yml down

# 重启特定服务
docker-compose -f docker-compose.dev.yml restart frontend

# 查看日志
docker-compose -f docker-compose.dev.yml logs -f backend

# 清理环境
docker-compose -f docker-compose.dev.yml down -v
docker system prune -a
```

### 代码管理
```bash
# 代码格式化
cd WebCode/todo-frontend && npm run format
cd ApiCode/ToDoListArea/ToDoListArea && dotnet format

# 运行测试
cd WebCode/todo-frontend && npm test
cd ApiCode/ToDoListArea && dotnet test

# 构建项目
cd WebCode/todo-frontend && npm run build
cd ApiCode/ToDoListArea/ToDoListArea && dotnet build
```

## 📞 技术支持

遇到问题时的处理步骤：

1. **查看相关文档**
   - [开发环境搭建指南](./开发环境搭建指南.md)
   - [开发环境故障排除](./开发环境故障排除.md)

2. **收集诊断信息**
   ```bash
   # 生成诊断报告
   docker-compose -f docker-compose.dev.yml logs > debug-logs.txt
   docker ps -a > debug-containers.txt
   ```

3. **联系开发团队**
   - 提供详细的错误信息
   - 包含诊断报告
   - 说明复现步骤

---

**最后更新**: 2025-08-04  
**文档版本**: v1.0
