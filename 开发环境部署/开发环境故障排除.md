# 🔧 ToDoListArea 开发环境故障排除指南

## 📋 目录
- [Docker相关问题](#docker相关问题)
- [数据库连接问题](#数据库连接问题)
- [前端开发问题](#前端开发问题)
- [后端API问题](#后端api问题)
- [网络和端口问题](#网络和端口问题)
- [性能问题](#性能问题)
- [常用诊断命令](#常用诊断命令)

## 🐳 Docker相关问题

### 问题1: Docker Desktop未启动
**症状**: 执行docker命令时提示"Docker daemon is not running"

**解决方案**:
```bash
# Windows
启动Docker Desktop应用程序

# Linux
sudo systemctl start docker
sudo systemctl enable docker

# macOS
启动Docker Desktop应用程序
```

### 问题2: Docker容器启动失败
**症状**: 容器状态显示为"Exited"或"Restarting"

**诊断步骤**:
```bash
# 查看容器状态
docker-compose -f docker-compose.dev.yml ps

# 查看容器日志
docker-compose -f docker-compose.dev.yml logs [service-name]

# 查看详细错误信息
docker logs [container-id] --details
```

**常见解决方案**:
1. **端口冲突**: 修改docker-compose.dev.yml中的端口映射
2. **内存不足**: 增加Docker Desktop的内存限制
3. **权限问题**: 确保Docker有足够的权限访问文件

### 问题3: Docker镜像构建失败
**症状**: docker-compose build命令失败

**解决方案**:
```bash
# 清理Docker缓存
docker system prune -a

# 重新构建镜像
docker-compose -f docker-compose.dev.yml build --no-cache

# 检查Dockerfile语法
docker build -t test-image -f Dockerfile .
```

## 🗄️ 数据库连接问题

### 问题1: SQL Server容器启动失败
**症状**: 数据库容器无法启动或立即退出

**诊断步骤**:
```bash
# 查看数据库容器日志
docker logs todolist-database-dev

# 检查密码复杂度
echo $DB_SA_PASSWORD
```

**解决方案**:
1. **密码不符合要求**: 确保SA密码包含大小写字母、数字和特殊字符
2. **内存不足**: SQL Server需要至少2GB内存
3. **许可协议**: 确保ACCEPT_EULA=Y

### 问题2: 应用无法连接数据库
**症状**: 后端API启动时报数据库连接错误

**诊断步骤**:
```bash
# 测试数据库连接
docker exec -it todolist-database-dev /opt/mssql-tools/bin/sqlcmd -S localhost -U sa -P "TodoList@2024!Dev" -Q "SELECT 1"

# 检查网络连接
docker network ls
docker network inspect todolistarea_todolist-network-dev
```

**解决方案**:
1. **等待数据库启动**: 数据库需要30-60秒完全启动
2. **检查连接字符串**: 确保服务名称为"database"而不是"localhost"
3. **网络问题**: 确保所有容器在同一网络中

### 问题3: 数据库数据丢失
**症状**: 重启容器后数据消失

**解决方案**:
```bash
# 检查数据卷
docker volume ls | grep todolistarea

# 备份数据卷
docker run --rm -v todolistarea_db_data_dev:/data -v $(pwd):/backup alpine tar czf /backup/db_backup.tar.gz -C /data .

# 恢复数据卷
docker run --rm -v todolistarea_db_data_dev:/data -v $(pwd):/backup alpine tar xzf /backup/db_backup.tar.gz -C /data
```

## 🎨 前端开发问题

### 问题1: 前端热重载不工作
**症状**: 修改前端代码后页面不自动刷新

**解决方案**:
```bash
# 检查文件挂载
docker exec -it todolist-frontend-dev ls -la /app/src

# 重启前端容器
docker-compose -f docker-compose.dev.yml restart frontend

# 检查Vite配置
docker exec -it todolist-frontend-dev cat vite.config.ts
```

### 问题2: 前端依赖安装失败
**症状**: npm install或yarn install失败

**解决方案**:
```bash
# 清理node_modules和package-lock.json
rm -rf WebCode/todo-frontend/node_modules
rm WebCode/todo-frontend/package-lock.json

# 使用国内镜像源
docker exec -it todolist-frontend-dev npm config set registry https://registry.npmmirror.com

# 重新安装依赖
docker exec -it todolist-frontend-dev npm install
```

### 问题3: 前端API请求失败
**症状**: 前端无法调用后端API，出现CORS错误

**诊断步骤**:
```bash
# 检查API基础URL配置
docker exec -it todolist-frontend-dev env | grep VITE_API_BASE_URL

# 测试API连接
curl http://localhost:5006/health
```

**解决方案**:
1. **CORS配置**: 检查后端CORS设置
2. **API地址**: 确保VITE_API_BASE_URL正确
3. **网络连接**: 确保前后端容器能够通信

## 🔧 后端API问题

### 问题1: 后端API启动失败
**症状**: 后端容器无法启动或启动后立即退出

**诊断步骤**:
```bash
# 查看后端日志
docker logs todolist-backend-dev

# 检查配置文件
docker exec -it todolist-backend-dev cat appsettings.Development.json
```

**解决方案**:
1. **配置错误**: 检查appsettings.json配置
2. **依赖问题**: 确保所有NuGet包正确安装
3. **端口冲突**: 检查5006端口是否被占用

### 问题2: API响应缓慢
**症状**: API请求响应时间过长

**诊断步骤**:
```bash
# 检查容器资源使用
docker stats todolist-backend-dev

# 查看API日志
docker logs todolist-backend-dev --tail 100
```

**解决方案**:
1. **增加容器资源**: 调整Docker Desktop内存限制
2. **数据库优化**: 检查数据库查询性能
3. **代码优化**: 检查是否有性能瓶颈

### 问题3: JWT认证失败
**症状**: 用户登录后API请求返回401错误

**解决方案**:
```bash
# 检查JWT配置
docker exec -it todolist-backend-dev env | grep JWT

# 验证JWT密钥
echo "检查JWT_SECRET_KEY是否足够长（至少32字符）"
```

## 🌐 网络和端口问题

### 问题1: 端口被占用
**症状**: 容器启动时提示端口已被使用

**诊断步骤**:
```bash
# Windows
netstat -ano | findstr :5006

# Linux/macOS
lsof -i :5006
netstat -tulpn | grep :5006
```

**解决方案**:
1. **停止占用进程**: 结束占用端口的进程
2. **修改端口**: 在docker-compose.dev.yml中修改端口映射
3. **使用其他端口**: 选择未被占用的端口

### 问题2: 容器间网络通信失败
**症状**: 容器之间无法相互访问

**诊断步骤**:
```bash
# 检查网络配置
docker network inspect todolistarea_todolist-network-dev

# 测试容器间连接
docker exec -it todolist-backend-dev ping database
```

**解决方案**:
1. **重建网络**: 删除并重新创建Docker网络
2. **检查服务名**: 确保使用正确的服务名称
3. **防火墙设置**: 检查防火墙是否阻止连接

## ⚡ 性能问题

### 问题1: 容器启动缓慢
**症状**: 容器需要很长时间才能启动

**解决方案**:
```bash
# 增加Docker Desktop资源
# 设置 -> Resources -> Advanced
# CPU: 4核心
# Memory: 8GB
# Swap: 2GB

# 使用本地镜像缓存
docker-compose -f docker-compose.dev.yml pull
```

### 问题2: 开发环境响应缓慢
**症状**: 页面加载和API响应都很慢

**诊断步骤**:
```bash
# 检查系统资源
docker stats

# 检查磁盘使用
docker system df
```

**解决方案**:
1. **清理Docker**: `docker system prune -a`
2. **增加资源**: 调整Docker Desktop设置
3. **优化代码**: 检查是否有性能问题

## 🔍 常用诊断命令

### Docker诊断命令
```bash
# 查看所有容器状态
docker ps -a

# 查看容器资源使用
docker stats

# 查看容器详细信息
docker inspect [container-name]

# 查看网络信息
docker network ls
docker network inspect [network-name]

# 查看数据卷信息
docker volume ls
docker volume inspect [volume-name]
```

### 应用诊断命令
```bash
# 检查服务健康状态
curl http://localhost:5006/health
curl http://localhost:5175

# 查看应用日志
docker-compose -f docker-compose.dev.yml logs -f --tail=100

# 进入容器调试
docker exec -it todolist-backend-dev bash
docker exec -it todolist-frontend-dev sh
```

### 网络诊断命令
```bash
# 测试端口连接
telnet localhost 5006
nc -zv localhost 5006

# 查看端口占用
netstat -tulpn | grep :5006  # Linux
netstat -ano | findstr :5006  # Windows
```

## 📞 获取帮助

如果以上解决方案都无法解决问题，请：

1. **收集诊断信息**:
   ```bash
   # 生成诊断报告
   docker-compose -f docker-compose.dev.yml config > debug-config.yml
   docker-compose -f docker-compose.dev.yml logs > debug-logs.txt
   docker ps -a > debug-containers.txt
   ```

2. **联系技术支持**:
   - 提供详细的错误信息
   - 包含诊断报告文件
   - 说明复现步骤

---

**最后更新**: 2025-08-04  
**文档版本**: v1.0
